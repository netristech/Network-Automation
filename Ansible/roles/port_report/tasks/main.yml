---
- name: Write CSV File and Header
  delegate_to: localhost
  shell: "echo 'Hostname,Port,Description,VLAN ID,MAC Address,IP Address' > port_report_{{ date }}"

- name: Get Interfaces - IOS
  cli_command:
    command: "show ip interf brief"
  register: int_list
  when: ansible_network_os == 'ios'

- name: Get Interfaces - NXOS
  cli_command:
    command: "show interf brief"
  register: int_list
  when: ansible_network_os == 'nxos'
  
- name: Parse Interfaces
  - name: Register Up
    set_fact:
      stat: "up"
    when: "'up' in {{ item }}"
  - name: Register Down
    set_fact:
      stat: "down"
    when: "'down' in {{ item }}"
  - name: Get Port Config
    cli_command:
      command: "show runnning-config interface {{ item.split()[0] }}"
    register: int_config
  - name: Write CSV Line
    delegate_to: localhost
    shell: "ehco '{{ inventory_hostname }},{{ item.split()[0] }},{{ stat }},,,,' > port_report_{{ date }}"
  loop: "{{ int_list.stdout_lines }}"
