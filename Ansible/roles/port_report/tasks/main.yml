---
#- name: Write CSV File and Header
  #delegate_to: localhost
  #shell: "echo 'Port,Description,Status,Extended Status,MAC Address,Vendor,IP Address,PoE' > {{ csv_file }}"
  
- name: Get OUI File From IEEE
  delegate_to: localhost
  shell: "cd /root && wget {{ oui_url }}"
    
- name: Create CSV file and Write Header
  delegate_to: localhost
  lineinfile:
    path: "{{ csv_file }}"
    line: Port,Description,Status,Extended Status,MAC Address,Vendor,IP Address,PoE
    create: yes

- name: Loop through interfaces
  include_tasks: loop.yml
  #debug:
    #msg: "{{ item }}"
  loop: "{{ lookup('dict', ansible_net_interfaces) }}"
  
- name: Email CSV
  delegate_to: localhost
  mail:
    host: 212.0.16.135
    port: 25
    subject: "Port Report For {{ ansible_net_hostname }}"
    body: Your report has been generated and is attached to this email.
    from: BBMUS@bbraunusa.com
    to: "{{ email }}"
    attach:
    - "{{ csv_file }}"

- name: Delete Local CSV File
  delegate_to: localhost
  file:
    path: "{{ csv_file }}"
    state: absent
